<!DOCTYPE html>
<html>
<head>
  <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"%>
  <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"%>
</head>
<body>
<div class="container">
  <div class="row">
    <div class="col-12">
      <h1><%= @posts.name %></h1>
    </div>
  </div>
  <div class="row bg-light p-4 text-center">
      <div class="col"><h5>Unit price: <%= @posts.price %>$</h5></div>
      <div class="col"><h5>Duration: <%= @posts.duration %> years</h5></div>
      <div class="col"><h5>Interest: <%= @posts.interest %>%</h5></div>
  </div>
  <div class="row  p-4 chart">
    <canvas id="InterestChart"></canvas>
    <%= javascript_tag defer: 'defer' do %>
      var price = <%= @posts.price %>
      var duration = <%= @posts.duration %>
      var interest = <%= @posts.interest %>
      var rateOfReturn = 1 + (interest / 100)
      var finalPrice = price * Math.pow(rateOfReturn, duration)
      var yearNow = moment()
      var returnYear = moment().add(duration, 'years')
      console.log('Final Price is: ', finalPrice)
      console.log('Years: ', yearNow, returnYear)

      var ctx = document.getElementById("InterestChart").getContext('2d');
      var InterestChart = new Chart(ctx, {
      type: 'bar',
      data: {
        datasets: [{
          data: [{t: yearNow, y:price},{t: returnYear, y:finalPrice}],
          label: "Valuation",
          borderWidth: 2,
          borderColor: "#333333",
          fill: false,
        }]
      },
      options: {
        scales: {
            xAxes: [{
              type: 'time',
              time: {
                parser: 'YYYY-MM-DD HH:mm:ss',
                unit: 'year',
                displayFormats: {
                      year: 'YYYY',
                },
                min: yearNow,
                max: returnYear
              },
              ticks: {
                  source: 'data'
              }
            }],
        },
      },
      plugins: [{
        beforeInit: function(chart) {
          var time = chart.options.scales.xAxes[0].time, // 'time' object reference
          timeDiff = moment(time.max).diff(moment(time.min), 'YYYY'); // difference (in days) between min and max date
          // populate 'labels' array
          // (create a date string for each date between min and max, inclusive)
          for (i = 0; i <= timeDiff; i++) {
          var _label = moment(time.min).add(i, 'YYYY').format('YYYY-MM-DD HH:mm:ss');
          chart.data.labels.push(_label);
          }
        }
      }]
      })
    <% end -%>
  </div>
</div>
</body>
</html>

<style>
  .chart {
    height: 500px;
  }
  #myChart {
    padding: 20px;
  }
</style>
