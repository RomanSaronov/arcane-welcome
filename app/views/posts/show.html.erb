<!DOCTYPE html>
<html>
<head>
  <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"%>
  <%= javascript_include_tag "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"%>
</head>
<body>
<div class="container">
  <div class="row">
    <div class="col-12">
      <h1><%= @posts.name %></h1>
    </div>
  </div>
  <div class="row bg-light p-4 text-center">
      <div class="col"><h5>Unit price: <%= @posts.price %>$</h5></div>
      <div class="col"><h5>Duration: <%= @posts.duration %> years</h5></div>
      <div class="col"><h5>Interest: <%= @posts.interest %>%</h5></div>
  </div>
  <div class="row  p-4 chart">
    <canvas id="InterestChart"></canvas>
    <%= javascript_tag defer: 'defer' do %>
      var price = <%= @posts.price %>
      var duration = <%= @posts.duration %>
      var interest = <%= @posts.interest %>
      var rate_of_return = 1 + (interest / 100)
      var final_price = price * Math.pow(rate_of_return, duration)
      var yearNow = (new Date()).getFullYear()
      console.log('Final Price is: ', final_price)
      console.log('Years: ', yearNow, yearNow + duration)

      var ctx = document.getElementById("InterestChart").getContext('2d');
      var InterestChart = new Chart(ctx, {
      type: 'line',
      data: {
      datasets: [{
        data: [price, final_price],
        label: "",
        borderWidth: 2,
        borderColor: "#3e95cd",
        fill: false,
        pointRadius: 0
      }]
      },
      options: {
        scales: {
      xAxes: [{
      type: 'time',
      time: {
      parser: 'YYYY-MM-DD HH:mm:ss',
      unit: 'day',
      displayFormats: {
      day: 'ddd'
      },
      min: '2017-10-02 18:43:53',
      max: '2017-10-09 18:43:53'
      },
      ticks: {
      source: 'data'
      }
      }],
            yAxes: [{
                ticks: {
                    min: 0,
                    max: final_price
                }
            }]
        },
      }
      });
    <% end -%>
  </div>
</div>
</body>
</html>

<style>
  .chart {
    height: 500px;
  }
  #myChart {
    padding: 20px;
  }
</style>
